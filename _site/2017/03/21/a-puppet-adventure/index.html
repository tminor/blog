<html>
  <head>
    <meta content='The beginning of a Puppet adventure. - tminor.io' property='og:title' />
    <title>The beginning of a Puppet adventure. - tminor.io</title>
    <link href='http://localhost:4000/images/fav.png' rel='shortcut icon'>
<link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css' />
<link href='http://localhost:4000/stylesheets/style.css' rel='stylesheet' type='text/css' />
<link href='http://localhost:4000/stylesheets/syntax.css' rel='stylesheet' type='text/css' />
<link href='http://localhost:4000/stylesheets/responsive.css' rel='stylesheet' type='text/css' />
<!-- - -->
<script src='http://localhost:4000/javascripts/jquery.js' type='text/javascript'></script>
<script src='http://localhost:4000/javascripts/pd.js' type='text/javascript'></script>
<script src='http://localhost:4000/javascripts/basics.js' type='text/javascript'></script>
<!--<script type="text/javascript" src="https://www.google.com/jsapi"></script>-->
<!-- - -->
<meta content='width=device-width, initial-scale=1.0, user-scalable=no' name='viewport'>
<meta content='text/html; charset=utf-8' http-equiv='content-type' />
<meta content="http://localhost:4000/og.png" property="og:image" />
<meta content="" property="fb:app_id" />

  <meta content='http://localhost:4000/2017/03/21/a-puppet-adventure/' property='og:url' />
  <meta content="Learning PuppetDuring this whole learning endeavor, my tendency has been to run headlong at whatever objective happen..." property='og:description' />
  <meta content="article" property="og:type" />

<!-- - -->
<!--<script type='text/javascript'>
  //<![CDATA[
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', '']);
    _gaq.push(['_trackPageview']);
    
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  //]]>
</script>-->
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_GB/all.js#xfbml=1&appId=";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

  </head>
  <body>
    <header>
<a id="go-back-home" href="http://localhost:4000"><img src="http://localhost:4000/images/shebang.svg" alt="#!" width="53" height="59"></a>
<p>tminor.io</p>
</header>

    <div id='container'>
      <div class="block">
  
    <a target="_top"
       class="main" 
       href="http://localhost:4000/about">
       About
     </a>
  
    <a target="_top"
       class="main" 
       href="http://localhost:4000https://blog.tminor.io">
       Blog
     </a>
  
    <a target="_top"
       class="main" 
       href="http://localhost:4000/feed.xml">
       RSS
     </a>
  
</div>
      <section class="paging">
  
    <div class="left">
      <a href="/2017/03/03/Kerberos-and-LDAP/">
        ‹
      </a>
    </div>
  
  
    <div class="right">
      <a href="/2017/04/08/web-security-1/">
        ›
      </a>
    </div>
  
</section>
      <div class="content">
        <section class='post'>
          <h1 class="upcase">
            <div class='date'>21 Mar 2017</div>
            The beginning of a Puppet adventure.
          </h1>
          <h3>Learning Puppet</h3>

<p>During this whole learning endeavor, my tendency has been to run headlong at whatever objective happens to stand next. For most things (such as Spacewalk) this works out well enough. With OpenLDAP, I learned that it wasn&rsquo;t necessarily the optimum strategy; doing so resulted in a lot of fustration born of copious amounts of trial and error, much of which could have been avoided with some reading and patience. Despite the frustration, I did come away with what I felt to be a more thorough understanding (though I do not intend to insenuate that I deeply understand its inner workings and every nuance&mdash;I certainly do not). Maybe it&rsquo;s self evident, but as complexity compounds, so does requisite research and general study&mdash;two things that I am not particularly adept at.</p>

<p>Puppet is yet another objective that is at odds with success via cursory research. So instead of yielding to weakness, I will instead attempt to distill my learning experience through some posts. Here we goooooo!</p>

<hr>

<h3>Fundamentals of Puppet</h3>

<p><em>much of what&rsquo;s found below is taken directly from Puppet&rsquo;s <a href="https://docs.puppet.com/puppet/4.9/index.html">documentation</a> and reworded</em></p>

<p><strong>What is Puppet and what does it do?</strong></p>

<p>Puppet is a configuration management tool written in Ruby. It uses its own declarative language to <em>declare</em> resources, classes, state, etc. that should be endemic to nodes on an as defined basis.</p>

<p><strong>Architecture and behavior</strong></p>

<p>Puppet uses one or more Puppet masters that manage nodes running Puppet agents. On a periodic basis, an agent sends a list of facts about the system on which it runs to the master and requests a catalog. Facts reference a number of attributes unique to a system such as an IP address, whether a file is present, what services are running, and so on. The requested catalog is a list of attributes that describe a desired state peculiar to that node; if the agent finds that a resource is not in a desired state, it makes the necessary changes. After applying changes, the agent sends a report to the master.</p>

<p><strong>About Puppet&rsquo;s DSL</strong></p>

<p>As alluded to above, Puppet&rsquo;s functionality is predicated on its declarative nature. Puppet&rsquo;s DSL declares resources, and according to the documentation, &ldquo;every other part of the language exists to add flexibility and convenience to the way resources are declared.&rdquo; Resources are grouped together in classes, where classes define configuration necessary to the functionality of a service or application. Smaller classes may be combined such that they provide a set of configuration, services, etc. necessary for e.g. a database server. Further, Puppet may also classify nodes. Node definitions dictate what classes should apply to a node. Alternatively, Puppet can utilize data provided from an <a href="https://docs.puppet.com/guides/external_nodes.html">External Node Classifier</a> or Hiera.</p>

<p><strong>Resources</strong></p>

<blockquote>
<p>Resources are the fundamental unit for modeling system configurations. Each resource describes some aspect of a system, like a specific service or package.</p>
</blockquote>

<p>Puppet enforces resources via catalogs; a catalog defines a desired state and ensures it through the application of declared resources.</p>

<p>Puppet resources have a type, title, and attribute-value pairs that conform to the following syntax:</p>

<figure class="highlight"><pre><code class="language-puppet" data-lang="puppet"><span class="na">type</span> <span class="p">{</span><span class="s">&#39;title&#39;</span><span class="p">:</span>
  <span class="na">attribute</span> <span class="o">=&gt;</span> <span class="na">value</span><span class="p">,</span>
<span class="p">}</span></code></pre></figure>

<p>Resource types dictate what aspects of configuration that resource can manage. Puppet has many built-in resource types such as files, services, and packages. New resource types can be defined in either Puppet or Ruby. </p>

<p>The title is an identifying string that must be unique per resource type; duplicate titles will cause a compilation failure. An example might be a file, in which case the title could be any arbitrary string value such as <code>&#39;spam&#39;</code>. Generally this is a bad idea and would annoy others and cause confusion; instead, a file would be better served in being identified by its path, such as <code>/etc/sssd/sssd.conf</code>.</p>

<p>Attributes describe the desired state of a resource; resources generally have attributes that are required, optional, and in many cases have attributes that contain default values if no value is specifically assigned.</p>

<p><strong>Ordering</strong></p>

<p>Puppet uses attributes called metaparameters that can be used with any resource type. Metaparameters do not directly define system state but rather define how resources should interact with each other. A common example would be a service and its configuration file:</p>

<figure class="highlight"><pre><code class="language-puppet" data-lang="puppet"><span class="k">package</span> <span class="p">{</span><span class="s">&#39;krb5-server&#39;</span><span class="p">:</span>
  <span class="na">ensure</span> <span class="o">=&gt;</span> <span class="k">present</span><span class="p">,</span>
  <span class="k">before</span> <span class="o">=&gt;</span> <span class="k">File</span><span class="p">[</span><span class="s">&#39;/etc/krb5.conf&#39;</span><span class="p">],</span>
<span class="p">}</span></code></pre></figure>

<p>The above code defines that the package for Kerberos 5 should be installed <em>before</em> ensuring the presence of its config file. Likewise, <code>require</code> can be used to establish the same dependency but with the opposite ordering:</p>

<figure class="highlight"><pre><code class="language-puppet" data-lang="puppet"><span class="k">file</span> <span class="p">{</span><span class="s">&#39;/etc/krb5.conf&#39;</span><span class="p">:</span>
  <span class="na">ensure</span>  <span class="o">=&gt;</span> <span class="k">file</span><span class="p">,</span>
  <span class="na">source</span>  <span class="o">=&gt;</span> <span class="s">&#39;puppet:///modules/kerberos/krb5.conf&#39;</span><span class="p">,</span>
  <span class="na">require</span> <span class="o">=&gt;</span> <span class="k">Package</span><span class="p">[</span><span class="s">&#39;krb5-server&#39;</span><span class="p">]</span>
<span class="p">},</span></code></pre></figure>

<p>The above is missing certain attributes that should otherwise be specified, but the point is nonetheless suitably illustrated.</p>

<p><strong>Classes</strong></p>

<blockquote>
<p>Classes are named blocks of Puppet code that are stored in modules for later use and are not applied until they are invoked by name.</p>
</blockquote>

<p>The syntax prescribes the following conventions:</p>

<figure class="highlight"><pre><code class="language-puppet" data-lang="puppet"><span class="k">class</span> <span class="na">name</span> <span class="p">(</span>
  <span class="na">String</span> <span class="nv">$variable</span> <span class="o">=</span> <span class="s">&#39;default value&#39;</span>
<span class="p">){</span>
  <span class="na">resource</span> <span class="p">{</span> <span class="s">&#39;title&#39;</span><span class="p">:</span>
    <span class="na">attribute</span> <span class="o">=&gt;</span> <span class="na">value</span><span class="p">,</span>
    <span class="na">attribute</span> <span class="o">=&gt;</span> <span class="nv">$variable,</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Class definitions contain the <code>class</code> keyword, a class name, and a comma-separated list of parameters. Past that are curly brackets (opening and closing) between which is arbitrary Puppet code.</p>

<p><strong>Manifests and modules</strong></p>

<p>Files containing Puppet code are called manifests and are appended with the <code>.pp</code> file extension. Class definitions are contained in manifests which are in turn contained within modules. The file structure for a module generally appears as follows:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">/etc/puppetlabs/code/environments/production/modules/ntp/
├── CHANGELOG.md
├── checksums.json
├── CONTRIBUTING.md
├── data
│   ├── . . .
├── examples
│   └── init.pp
├── Gemfile
├── hiera.yaml
├── LICENSE
├── manifests
│   ├── config.pp
│   ├── init.pp
│   ├── install.pp
│   └── service.pp
├── metadata.json
├── NOTICE
├── Rakefile
├── README.markdown
├── spec
│   ├── acceptance
│   │   ├── . . .
├── templates
│   ├── keys.epp
│   ├── ntp.conf.epp
│   └── step-tickers.epp
└── types
    ├── key_id.pp
    └── poll_interval.pp
</code></pre></div>
<hr>

<p><strong>END</strong></p>

<p>I think that covers the fundamentals reasonably well. For a much better, more in depth explanation, see <a href="https://docs.puppet.com/puppet/4.9/index.html">the official documentation</a>.</p>

<p>In the next post, I&rsquo;ll probably cover the set up of a Puppet master and its agents. My initial research shows that there&rsquo;s not much to it, so hopefully it will be a short one.</p>

          <!--
<br />
<p>
  Until next time,<br/>
  Thomas
  <span class="muted">at 05:17</span>
</p>
<p>
  <img src="/images/blog.svg" alt="./blog.sh" width="70" height="40" /> 
</p>
-->


        </section>
      </div>
      

      
        <div class="block">
  <div id="disqus_thread"></div>
    <script>
      /**
      *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
      *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
      */
      /*
      var disqus_config = function () {
        this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
      };
      */
      (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');

        s.src = '//blog-tminor-io.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
      })();
    </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>

      
      <div class="block">
  
    <a target="_top"
       class="main" 
       href="http://localhost:4000/about">
       About
     </a>
  
    <a target="_top"
       class="main" 
       href="http://localhost:4000https://blog.tminor.io">
       Blog
     </a>
  
    <a target="_top"
       class="main" 
       href="http://localhost:4000/feed.xml">
       RSS
     </a>
  
</div>
    </div>
    <!--
<footer>
  <a href="http://github.com/muan/scribble" class="muted">built with Jekyll using Scribble theme</a>
  <br />
  <br />
  <img src="http://localhost:4000/images/eof.svg" alt="./blog.sh" width="40" height="27"/> 
</footer>
-->

  </body>
</html>
